<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Front-Office Next</title>
  <script type="module" src="index.js"></script>
  <link rel="stylesheet" type="text/css" href="index.scss">
  <link rel="stylesheet" type="text/css" href="assets/github.css">
</head>
<body>
  <main class="slides">
    <section id="title">
      <h1>KURATOR<br>Front-Office Next</h1>
      <footer class="notes">
        <p class="note">Hi!</p>
      </footer>
    </section>

    <section id="kurator">
      <figure>
        <img src="assets/images/back-office.jpg">
        <figcaption>Back-Office</figcaption>
      </figure>
      <figure>
        <img src="assets/images/front-office.jpg">
        <figcaption>Front-Office</figcaption>
      </figure>
      <footer class="notes">
        <p class="note">We are very fond of cute code names here at NRK</p>
        <p class="note">This is Kurator. It has two components: Back-Office is the application Journalists use to edit content, and Front-Office is the application that renders that content for the web</p>
      </footer>
    </section>

    <section id="front-office">
      <figure>
        <img src="assets/images/front-office-full.jpg">
        <span class="highlight-house"><span>house</span></span>
        <span class="highlight-floor"><span>floor</span></span>
        <span class="highlight-room"><span>room</span></span>
        <span class="highlight-newsfeed"><span>guestroom - newsfeed</span></span>
      </figure>
      <footer class="notes">
        <p class="note">Front-Office is further divided into multiple parts</p>
        <p class="note">This is a house</p>
        <p class="note">This is a floor in that house</p>
        <p class="note">This is a room in that floor</p>
        <p class="note">And this is a guestroom called newsfeed</p>
      </footer>
    </section>

    <section id="front-office-next">
      <figure>
        <img src="assets/images/front-office-full.jpg">
        <figcaption>Previous</figcaption>
      </figure>
      <figure>
        <img src="assets/images/front-office-full.jpg">
        <figcaption>Next</figcaption>
      </figure>
      <footer class="notes">
        <p class="note">Last summer I asked Kristoffer, who was tech lead for Kurator at the time, if we could rewrite Front-Office. He said yes, as long as it looked exactly like the existing version</p>
        <p class="note">Six months later, we have two versions of Front-Office: Previous and Next</p>
      </footer>
    </section>

    <section id="pixel">
      <figure>
        <div class="pixel previous"></div>
        <figcaption>Previous</figcaption>
      </figure>
      <figure>
        <div class="pixel next"></div>
        <figcaption>Next</figcaption>
      </figure>
      <footer class="notes">
        <p class="note">If we compare a pixel from Previous and one from Next, they look the same</p>
        <p class="note">But if a user gets that pixel sooner, are they really the same?</p>
        <p class="note">And if a user wants a blue version of that pixel...</p>
        <p class="note">...or purple...</p>
        <p class="note">...or green...</p>
        <p class="note">...then they really aren't the same at all</p>
      </footer>
    </section>

    <section id="feature">
      <h1>Performance is a <em>feature</em></h1>
      <footer class="notes">
        <p class="note">This was the real motivation for the rewrite: improve render performance in order to be able to offer customized content</p>
        <p class="note">Performance is hard to observe directly, but it can enable other more visible features, and we wanted to open up for delivering personalised content on nrk.no</p>
      </footer>
    </section>

    <section id="motivation">
      <h1>"reducing complexity is the most important element of software design"</h1>
      <footer class="notes">
        <p class="note">My real motivation, however, was to design a system that was simpler</p>
      </footer>
    </section>

    <section id="book">
      <img src="assets/images/book.jpg">
      <ul>
        <li class="one">"the greatest limitation in writing software is our ability to understand the systems we are creating"</li>
        <li class="two">"developers [...] should always be on the lookout for opportunities to improve the design of the system"</li>
        <li class="three">"developers should always be thinking about complexity"</li>
      </ul>
      <footer class="notes">
        <p class="note">This book by John Ousterhout is fantastic, and basically deals with high level techniques for reducing complexity in software systems</p>
        <p class="note">quote</p>
        <p class="note">quote</p>
        <p class="note">quote</p>
      </footer>
    </section>

    <section id="config">
      <h1>#1 Configuration</h1>
      <pre class="code config-json"><code class="json">
        {
          "api": {
            "cacheMaxSize": 1000,
            "maxAgeFeed": "1m",
            "maxAgeImmutable": "24h",
            "maxAgeMutable": "1s",
            "origin": "${__SUPPLIED_BY_ENV__}",
            "pathnames": {
              "blueprint": "/houses/${id}/ids",
              "house": "/houses/${itemId}/${id}",
              "feed": "/${type}/houses/${houseId}",
              "floor": "/floors/${itemId}/${id}",
              "room": "/rooms/${itemId}/${id}"
            },
            "retry": "${__SUPPLIED_BY_ENV__}",
            "secretKey": "${API_SECRET}",
            "timeout": "${__SUPPLIED_BY_ENV__}",
            "urls": "**generated at runtime**"
          }
        }
      </code></pre>
      <pre class="code config-dir"><code class="txt">
        /config
          **files here are added by runtime env**.txt
          **files here are loaded in sort order**.txt
          local.json
      </code></pre>
      <pre class="code config-js"><code class="js">
        import config from '@nrk/frontend-common/config.js';

        const houseEndpoint = config.get('api.urls.house');
        // => https://kurator-api-stage.nrk.no/houses/${itemId}/${id}
        const apartmentEndpoint = config.get('api.urls.apartment');
        // => Boom! Error: no config value found for "api.urls.apartment"
      </code></pre>
      <pre class="code config-node-env"><code class="json">
        {
          "NODE_ENV": {
            "test": {
              "api": {
                "origin": "http://localhost:8080"
              }
            },
            "production": {
              "api": {
                "origin": "https://kurator-api.nrk.no"
              }
            }
          }
        }
      </code></pre>
      <footer class="notes">
        <p class="note">One of the most important goals of good design is for a system to be obvious</p>
        <p class="note">One place where being obvious is important is application configuration</p>
        <p class="note">Our new config setup describes all configuration options in one place (config.json), and is explicit about which values must be supplied by the runtime environment</p>
        <p class="note">Environment values are loaded from the /config directory, which can be populated using Kubernetes ConfigMaps</p>
        <p class="note">During runtime, any missing environment variables will throw and cause the application to crash, preventing rollout</p>
        <p class="note">Reading non-existant values will also throw an error. Obvious errors are simpler to fix than hidden ones</p>
        <p class="note">Another benefit of being explicit is that the application has no concept of environment, only configuration, which is also much simpler</p>
      </footer>
    </section>

    <section id="dev-env">
      <h1>#2 Development Environment</h1>

      <footer class="notes">
        <p class="note">Probably the biggest differnce between Previous and Next is the development environment</p>
        <p class="note">Previous used Nodemon to restart the application server, Babel to transpile server code, and Webpack to compile assets for the browser</p>
        <p class="note">This type of tooling chain is complex to set up, slow to restart after changes, and requires special server middleware to be used, forcing the application to be aware of it's environment</p>
        <p class="note">Next uses dvlp to restart the application server, esm to enable es modules for server code, and no asset compiler (except Sass)</p>
        <p class="note">Most importantly, however, is that the application itself is totally unaware it's running in development. There is no difference between development and production code beyond configuration</p>
        <p class="note">With dvlp we also get easy mocking during runtime and testing</p>
      </footer>
    </section>

    <section id="modules">
      <h1>#3 ES Modules</h1>
      <footer class="notes">
        <p class="note"></p>
      </footer>
    </section>

    <section id="templates">
      <h1>#4 Tagged Template Literals</h1>
      <footer class="notes">
        <p class="note"></p>
      </footer>
    </section>

    <section id="streaming">
      <h1>#5 Streaming Renderer</h1>
      <footer class="notes">
        <p class="note"></p>
      </footer>
    </section>

    <section id="cache">
      <h1>#6 Caching</h1>
      <footer class="notes">
        <p class="note"></p>
      </footer>
    </section>

    <section id="custom-elements">
      <h1>#7 Custom Elements</h1>
      <footer class="notes">
        <p class="note"></p>
      </footer>
    </section>

    <section id="sse">
      <h1>#8 EventSource</h1>
      <footer class="notes">
        <p class="note"></p>
      </footer>
    </section>

    <section id="embed">
      <h1>#9 Core-Embed</h1>
      <footer class="notes">
        <p class="note"></p>
      </footer>
    </section>
  </main>
  <div class="clock"></div>
</body>
</html>
